{"version":3,"sources":["../../../src/local/tests/statevalues.js"],"names":["Test","fakenode","document","createTextNode","statemanager","StateManager","setInitialState","sample","value","assertEquals","state","samples","id","name","get","expectException","plainstate","simpleattributes1","simpleattributes2","listwithoutid","listofsimpleitems","setReadOnly","set","key","valuewithoutkey","valuedifferentkey","valuewithoutid","add","TestBase"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Test component.\n *\n * Important note: this is internal testing. Components should never user state manager or\n * reactive module directly. Only reactive instances can do it this way.\n *\n * @module     format_editortest/local/tests/statevalues\n * @package    core_course\n * @copyright  2020 Ferran Recio <ferran@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport StateManager from 'core/local/reactive/statemanager';\nimport TestBase from 'format_editortest/local/tests/testbase';\n\nclass Test extends TestBase {\n\n    /**\n     * Scenario setup.\n     */\n    setUp() {\n        // We don't care about events this time.\n        this.fakenode = document.createTextNode(null);\n        this.statemanager = new StateManager(() => true, this.fakenode);\n    }\n\n    /**\n     * Create a valid initial state.\n     */\n    testAddObject() {\n        this.statemanager.setInitialState({\n            sample: {\n                value: 'OK',\n            }\n        });\n        this.assertEquals(null, 'OK', this.statemanager.state.sample.value);\n    }\n\n    /**\n     * Create a state list initial state.\n     */\n    testAddList() {\n        this.statemanager.setInitialState({\n            samples: [\n                {id: 3, name: 'first'},\n                {id: 4, name: 'second'},\n            ],\n        });\n        this.assertEquals(null, undefined, this.statemanager.state.samples.get(1));\n        this.assertEquals(null, undefined, this.statemanager.state.samples.get(2));\n        this.assertEquals(null, 3, this.statemanager.state.samples.get(3).id);\n        this.assertEquals(null, 'first', this.statemanager.state.samples.get(3).name);\n        this.assertEquals(null, 4, this.statemanager.state.samples.get(4).id);\n        this.assertEquals(null, 'second', this.statemanager.state.samples.get(4).name);\n    }\n\n    /**\n     * Test invalid state values.\n     *\n     * @param {*} state the initial state\n     */\n    testInvalidState(state) {\n\n        this.expectException();\n        this.statemanager.setInitialState(state);\n    }\n\n    /**\n     * Data provider for testInvalidState.\n     *\n     * @returns {object} testting scenarios\n     */\n    dataProviderTestInvalidState() {\n        return {\n            // States must be objects.\n            plainstate: 'nope',\n            // All state objects must be objects, not simple variables.\n            simpleattributes1: {\n                value: 'Nope',\n            },\n            simpleattributes2: {\n                value: null,\n            },\n            // List items must provide an ID attribute.\n            listwithoutid: {\n                samples: [\n                    {id: 3, name: 'first'},\n                    {name: 'second'},\n                ],\n            },\n            // List element cannot be simple variables.\n            listofsimpleitems: {\n                samples: ['j', 2, true],\n            },\n        };\n    }\n\n    testSetListValue() {\n        this.statemanager.setInitialState({\n            samples: [\n                {id: 3, name: 'first'},\n                {id: 4, name: 'second'},\n            ],\n        });\n\n        this.assertEquals(null, 3, this.statemanager.state.samples.get(3).id);\n        this.assertEquals(null, 'first', this.statemanager.state.samples.get(3).name);\n        this.assertEquals(null, 4, this.statemanager.state.samples.get(4).id);\n        this.assertEquals(null, 'second', this.statemanager.state.samples.get(4).name);\n\n        this.statemanager.setReadOnly(false);\n\n        // Add a value.\n        this.statemanager.state.samples.set(1, {id: 1, name: 'new'});\n        this.assertEquals(null, 1, this.statemanager.state.samples.get(1).id);\n        this.assertEquals(null, 'new', this.statemanager.state.samples.get(1).name);\n\n        // Alter a value.\n        this.statemanager.state.samples.set(3, {id: 3, name: 'newvalue'});\n        this.assertEquals(null, 3, this.statemanager.state.samples.get(3).id);\n        this.assertEquals(null, 'newvalue', this.statemanager.state.samples.get(3).name);\n\n        // Check again the 4 element to test if it remains the same.\n        this.assertEquals(null, 4, this.statemanager.state.samples.get(4).id);\n        this.assertEquals(null, 'second', this.statemanager.state.samples.get(4).name);\n    }\n\n    /**\n     * Test invalid list element values.\n     *\n     * @param {*} scenario the scenario key and value\n     */\n    testSetInvalidListValues({key, value}) {\n        this.statemanager.setInitialState({\n            samples: [\n                {id: 3, name: 'first'},\n                {id: 4, name: 'second'},\n            ],\n        });\n\n        this.statemanager.setReadOnly(false);\n\n        this.expectException();\n        this.statemanager.state.samples.set(key, value);\n    }\n\n    /**\n     * Data provider for testSetInvalidListValues.\n     *\n     * @returns {object} the testing sacenarios\n     */\n    dataProviderTestSetInvalidListValues() {\n        return {\n            // All element needs a key.\n            valuewithoutkey: {\n                key: undefined,\n                value: {id: 1, name: 'new'},\n            },\n            // All elements key must be the same as the element id.\n            valuedifferentkey: {\n                key: 42,\n                value: {id: 25, name: 'new'},\n            },\n            // All list elements must have an id attribute.\n            valuewithoutid: {\n                key: 43,\n                value: {name: 'new'},\n            },\n        };\n    }\n\n    /**\n     * Test add list elements function.\n     */\n    testAddListValue() {\n        this.statemanager.setInitialState({\n            samples: [\n                {id: 3, name: 'first'},\n                {id: 4, name: 'second'},\n            ],\n        });\n\n        this.assertEquals(null, 3, this.statemanager.state.samples.get(3).id);\n        this.assertEquals(null, 'first', this.statemanager.state.samples.get(3).name);\n        this.assertEquals(null, 4, this.statemanager.state.samples.get(4).id);\n        this.assertEquals(null, 'second', this.statemanager.state.samples.get(4).name);\n\n        this.statemanager.setReadOnly(false);\n\n        // Add a value.\n        this.statemanager.state.samples.add({id: 1, name: 'new'});\n        this.assertEquals(null, 1, this.statemanager.state.samples.get(1).id);\n        this.assertEquals(null, 'new', this.statemanager.state.samples.get(1).name);\n\n        // Alter a value.\n        this.statemanager.state.samples.add({id: 3, name: 'newvalue'});\n        this.assertEquals(null, 3, this.statemanager.state.samples.get(3).id);\n        this.assertEquals(null, 'newvalue', this.statemanager.state.samples.get(3).name);\n\n        // Check again the 4 element to test if it remains the same.\n        this.assertEquals(null, 4, this.statemanager.state.samples.get(4).id);\n        this.assertEquals(null, 'second', this.statemanager.state.samples.get(4).name);\n    }\n\n    /**\n     * Test invalid list elements.\n     *\n     * @param {object} value the invalid value\n     */\n    testAddInvalidListValues(value) {\n        this.statemanager.setInitialState({\n            samples: [\n                {id: 3, name: 'first'},\n                {id: 4, name: 'second'},\n            ],\n        });\n\n        this.statemanager.setReadOnly(false);\n\n        this.expectException();\n        this.statemanager.state.samples.add(value);\n    }\n\n    /**\n     * Data provider for testAddInvalidListValues.\n     *\n     * @returns {object} testing scenarios\n     */\n    dataProviderTestAddInvalidListValues() {\n        return {\n            // All element needs a valur key.\n            valuewithoutkey: {id: undefined, name: 'new'},\n            // All list elements must have an id attribute.\n            valuewithoutid: {name: 'new'},\n        };\n    }\n}\n\nexport default new Test();\n"],"file":"statevalues.min.js"}